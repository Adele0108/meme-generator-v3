# 项目模块说明

## 项目概述

本土化Meme表情包生成器是一个功能完整的纯前端应用，支持从图片输入到最终导出的全流程表情包制作。

## 核心模块架构

项目共包含 **7大核心模块**：

---

## 1. 📸 图片输入模块

**功能**：提供多种方式获取图片

### 1.1 本地图片上传
- 点击上传区域选择文件
- 拖拽文件到上传区域
- 支持常见图片格式（JPG、PNG、GIF、WebP等）
- **代码位置**：`handleImageUpload()`, `handleDrop()`, `handleDragOver()`

### 1.2 模板选择
- 预设模板图片（熊猫头、狗头、猫头、黄油小熊、奶龙）
- 点击模板图片即可加载
- **代码位置**：`loadTemplate()`, `templateData`

### 1.3 网络图片搜索
- 使用 Pexels API 搜索网络图片
- 支持关键词搜索
- 点击搜索结果图片即可加载
- 提供百度图片搜索跳转
- **代码位置**：`searchImages()`, `loadImageFromUrl()`

### 1.4 AI图片生成
- 集成通义万相 API 生成图片
- 根据文字描述生成图片
- 支持多种尺寸比例
- **代码位置**：`generateWithQwen()`, `callQwenImage()`

---

## 2. ✏️ 文案生成模块

**功能**：提供多种方式生成和输入文案

### 2.1 直接输入文案
- 文本输入框直接输入
- 支持语音输入（Web Speech API）
- 点击"应用文案"按钮应用
- **代码位置**：`applyTextToCanvas()`, `textInput`

### 2.2 关键词生成文案
- 输入情绪关键词（无语、狂喜、摸鱼等）
- 选择标签（emo、暴躁、感动等）
- 点击"生成文案"获取建议列表
- 支持"一键生成"快速应用
- **代码位置**：`generateMemeText()`, `generateTexts()`, `generateTextsWithTags()`

### 2.3 AI文案生成
- 集成通义千问 API 生成文案
- 根据图片描述和用途生成文案
- **代码位置**：`callQwenText()`

### 2.4 文案编辑
- 选中文案后可编辑
- 支持键盘快捷键（Enter保存，Esc取消）
- **代码位置**：`showTextEditor()`, `saveTextEdit()`, `cancelTextEdit()`

---

## 3. 🎨 文字样式编辑模块

**功能**：调整文字的外观样式

### 3.1 字体设置
- 字体大小（10-200px，滑块调整）
- 字体族（微软雅黑、黑体、宋体、楷体等）
- **代码位置**：`fontSizeSelect`, `fontFamilySelect`, `currentFontSize`, `currentFontFamily`

### 3.2 颜色设置
- 文字颜色（颜色选择器）
- 描边颜色（颜色选择器）
- 支持语音调整颜色
- **代码位置**：`textColorSelect`, `strokeColorSelect`, `setTextColor()`

### 3.3 文字位置
- 支持拖拽调整文字位置
- 鼠标和触摸设备都支持
- **代码位置**：`handleCanvasMouseDown()`, `handleCanvasTouchStart()`, `textPosition`

### 3.4 文字渲染
- Canvas 绘制文字
- 支持描边效果
- 自动换行处理
- **代码位置**：`applyTextToCanvas()`, `drawTextOnCanvas()`

---

## 4. 🖼️ 图片处理模块

**功能**：对图片进行各种处理

### 4.1 图片裁剪
- 手动选择裁剪区域
- 支持鼠标和触摸操作
- 实时预览裁剪效果
- **代码位置**：`startCrop()`, `confirmCrop()`, `cancelCrop()`, 裁剪相关事件处理

### 4.2 GIF处理
- 支持 GIF 图片加载和显示
- GIF 帧解析（使用 gifuct-js）
- GIF 导出（使用 gif.js）
- **代码位置**：`loadGifImage()`, `loadGifImageDirectly()`, `downloadGifMeme()`

### 4.3 图片显示
- Canvas 渲染图片
- 支持多种尺寸比例
- 移动端适配
- **代码位置**：`displayImage()`, `memeCanvas`

### 4.4 用途适配
- 表情包（1:1）
- 海报（1080x1440）
- 公众号首图（900x383）
- 宣传图（1080x1350）
- 保留原始比例
- **代码位置**：`getUseTypeInfo()`, `useTypeSelect`

---

## 5. 🎤 语音控制模块

**功能**：通过语音控制整个流程

### 5.1 语音输入
- AI生成区域的语音输入
- 文案输入区域的语音输入
- 实时语音转文字
- **代码位置**：`toggleSpeechRecognition()`, `toggleTextSpeechRecognition()`, `createRecognitionInstance()`

### 5.2 全局语音控制
- 一键启动全局语音控制
- 支持完整的语音命令系统
- 实时反馈执行结果
- **代码位置**：`startGlobalVoiceControl()`, `stopGlobalVoiceControl()`, `checkVoiceCommand()`

### 5.3 语音命令
- 模板选择："选择熊猫头"、"选择狗头"等
- 文案操作："生成文案"、"应用文案"等
- 样式调整："字体大一点"、"改成红色"等
- 下载操作："下载"、"保存"等
- 智能命令解析
- **代码位置**：`voiceCommands`, `checkVoiceCommand()`

---

## 6. 🔧 可视化编辑工作台模块

**功能**：专业的图层编辑功能

### 6.1 图层管理
- 添加文字图层
- 选择、编辑、删除图层
- 图层列表显示
- **代码位置**：`addTextLayer()`, `selectLayer()`, `deleteLayer()`, `layers`

### 6.2 属性编辑
- 文字内容编辑
- 样式属性调整
- 位置和大小设置
- **代码位置**：`propertyPanel`, `updateLayerProperties()`

### 6.3 历史版本
- 操作历史记录
- 版本回退
- 清空历史
- **代码位置**：`historyStack`, `saveHistory()`, `restoreHistory()`

### 6.4 工作台导出
- 导出当前版本
- 支持多种格式
- **代码位置**：`exportWorkspace()`

---

## 7. 💾 导出下载模块

**功能**：将生成的表情包保存到本地

### 7.1 静态图片下载
- PNG 格式导出
- 支持 Canvas 转图片
- 自动处理跨域问题
- **代码位置**：`downloadMeme()`, `downloadStaticMeme()`

### 7.2 GIF下载
- GIF 格式导出
- 多帧处理
- 保持动画效果
- **代码位置**：`downloadGifMeme()`

### 7.3 移动端适配
- 长按保存功能
- 触摸优化
- **代码位置**：`savePreview`

---

## 模块依赖关系

```
图片输入模块
    ↓
文案生成模块
    ↓
文字样式编辑模块 ← 语音控制模块
    ↓
图片处理模块
    ↓
可视化编辑工作台模块（可选）
    ↓
导出下载模块
```

## 技术栈

- **前端框架**：纯原生 JavaScript（无框架依赖）
- **UI渲染**：HTML5 Canvas
- **语音识别**：Web Speech API
- **GIF处理**：gif.js + gifuct-js
- **API集成**：通义千问/万相 API、Pexels API
- **样式**：CSS3（响应式设计）

## 文件结构

```
Meme-generator-v3/
├── meme-generator.html      # 主页面结构
├── meme-generator.js         # 核心功能代码（7大模块）
├── meme-generator.css        # 样式文件
├── images/                   # 模板图片资源
├── README.md                 # 项目说明
├── 部署说明.md              # 部署指南
├── 语音控制完整功能说明.md  # 语音功能文档
└── 项目模块说明.md          # 本文档
```

## 模块代码分布

| 模块 | 主要函数/代码位置 | 行数范围（约） |
|------|-----------------|--------------|
| 图片输入 | `handleImageUpload()`, `loadTemplate()`, `searchImages()`, `generateWithQwen()` | 1100-1600 |
| 文案生成 | `generateMemeText()`, `applyTextToCanvas()`, `generateTexts()` | 1600-2000 |
| 文字样式 | `adjustFontSize()`, `setTextColor()`, 样式选择器事件 | 200-600 |
| 图片处理 | `startCrop()`, `loadGifImage()`, `displayImage()` | 1100-1500, 3270+ |
| 语音控制 | `startGlobalVoiceControl()`, `checkVoiceCommand()`, `voiceCommands` | 426-1100 |
| 工作台 | `enterWorkspace()`, `addTextLayer()`, `exportWorkspace()` | 2730-3270 |
| 导出下载 | `downloadMeme()`, `downloadStaticMeme()`, `downloadGifMeme()` | 2000-2100 |

## 扩展建议

每个模块都可以独立扩展：

1. **图片输入模块**：支持更多图片来源（Unsplash、Pixabay等）
2. **文案生成模块**：集成更多AI模型（GPT、Claude等）
3. **文字样式模块**：添加更多字体、特效
4. **图片处理模块**：添加滤镜、贴纸等功能
5. **语音控制模块**：支持更多语言、离线识别
6. **工作台模块**：添加图片图层、形状图层
7. **导出模块**：支持更多格式（SVG、PDF等）

---

**总结**：项目采用模块化设计，7大核心模块相互配合，实现了从图片输入到最终导出的完整表情包制作流程。

